<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEON ABYSS // INSTANT PLAY</title>
<style>
  body{margin:0;overflow:hidden;background:#000}
  #ui{position:fixed;inset:0;pointer-events:none;color:#0ff;font:20px monospace}
  #crosshair{position:absolute;top:50%;left:50%;width:30px;height:30px;margin:-15px;
    background:radial-gradient(circle,transparent 45%,#0ff 46%,#0ff 50%,transparent 51%);
    opacity:0.9;box-shadow:0 0 20px #0ff}
  #hud{position:absolute;bottom:20px;left:20px;text-shadow:0 0 10px #0ff}
</style>
</head>
<body>

<div id="ui">
  <div id="crosshair">+</div>
  <div id="hud">SCORE <span id="s">0</span> HEALTH <span id="h">100</span> AMMO <span id="a">30</span>/<span id="ta">90</span></div>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.169.0/build/three.module.js';
import {PointerLockControls} from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/controls/PointerLockControls.js';
import {EffectComposer} from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/EffectComposer.js';
import {RenderPass} from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/RenderPass.js';
import {UnrealBloomPass} from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/UnrealBloomPass.js';

const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000020, 0.001);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));
composer.addPass(new UnrealBloomPass(undefined, 1.6, 0.5, 0.85));

scene.add(new THREE.AmbientLight(0x4040ff, 0.6));
const l1 = new THREE.PointLight(0xff00ff, 4, 100); l1.position.set(0,20,0); scene.add(l1);
const l2 = new THREE.PointLight(0x00ffff, 4, 100); l2.position.set(30,20,-30); scene.add(l2);

const controls = new PointerLockControls(camera, renderer.domElement);
scene.add(controls.getObject());

// Auto-lock on first click or mousemove
document.body.addEventListener('click', () => controls.isLocked || controls.lock());
document.body.addEventListener('mousemove', () => controls.isLocked || controls.lock());

// Ground + neon crates
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(1000,1000),
  new THREE.MeshStandardMaterial({color:0x001133, metalness:0.9, roughness:0.2})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

for(let i=0;i<100;i++){
  const s = 2+Math.random()*6;
  const box = new THREE.Mesh(
    new THREE.BoxGeometry(s,s,s),
    new THREE.MeshStandardMaterial({
      color:0x112244,
      emissive:Math.random()>0.5?0x00ffff:0xff00ff,
      emissiveIntensity:0.7
    })
  );
  const a = Math.random()*Math.PI*2;
  const d = 20+Math.random()*100;
  box.position.set(Math.cos(a)*d, s/2, Math.sin(a)*d);
  scene.add(box);
}

// Game vars
let ammo=30, totalAmmo=90, score=0;
const enemies=[], bullets=[];
const pos = new THREE.Vector3(0,5,0);
const vel = new THREE.Vector3();
const keys = {};

onkeydown = onkeyup = e => keys[e.key.toLowerCase()] = e.type[5]=='d';

// Shooting
document.addEventListener('click', () => {
  if(!controls.isLocked || ammo<=0) return;
  ammo--;
  document.getElementById('a').textContent = ammo;
  
  const dir = new THREE.Vector3();
  camera.getWorldDirection(dir);
  bullets.push({
    pos: camera.position.clone(),
    vel: dir.multiplyScalar(400),
    life: 80
  });
});

// Reload
document.addEventListener('keydown', e => {
  if(e.key==='r' && totalAmmo>0){
    const take = Math.min(30-ammo, totalAmmo);
    ammo += take; totalAmmo -= take;
    document.getElementById('a').textContent = ammo;
    document.getElementById('ta').textContent = totalAmmo;
  }
});

// Enemy spawner
setInterval(()=>enemies.length<25&&spawnEnemy(), 1200);

function spawnEnemy(){
  const e = new THREE.Mesh(
    new THREE.DodecahedronGeometry(2),
    new THREE.MeshStandardMaterial({color:0xff0044, emissive:0xff0044, emissiveIntensity:1})
  );
  const a = Math.random()*Math.PI*2;
  e.position.set(Math.cos(a)*80, 6, Math.sin(a)*80);
  scene.add(e);
  e.add(new THREE.PointLight(0xff0044, 4, 40));
  enemies.push(e);
}

function animate(){
  requestAnimationFrame(animate);

  // Movement
  const speed = keys['shift']?30:15;
  const forward = new THREE.Vector3();
  camera.getWorldDirection(forward); forward.y=0; forward.normalize();
  const right = new THREE.Vector3().crossVectors(forward, new THREE.Vector3(0,1,0));
  vel.set(0,0,0);
  if(keys['w']) vel.add(forward);
  if(keys['s']) vel.sub(forward);
  if(keys['a']) vel.sub(right);
  if(keys['d']) vel.add(right);
  if(vel.lengthSq()>0) vel.normalize().multiplyScalar(speed);
  pos.add(vel.multiplyScalar(0.016));
  controls.getObject().position.copy(pos);
  controls.getObject().position.y += 1.6;

  // Enemies chase player
  enemies.forEach(e=>{
    const to = pos.clone().sub(e.position);
    to.y=0; to.normalize();
    e.position.add(to.multiplyScalar(2.5));
    e.rotation.y += 0.05;
  });

  // Bullets & hits
  bullets.forEach((b,i)=>{
    b.pos.add(b.vel.clone().multiplyScalar(0.016));
    b.life--;
    if(b.life<0){ bullets.splice(i,1); return; }
    enemies.forEach((e,j)=>{
      if(e.position.distanceTo(b.pos)<3){
        score += 100;
        document.getElementById('s').textContent = score;
        scene.remove(e);
        enemies.splice(j,1);
        bullets.splice(i,1);
      }
    });
  });

  l1.intensity = 4 + Math.sin(performance.now()*0.003)*2;
  composer.render();
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
  composer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
